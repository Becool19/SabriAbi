{% extends "base.html" %}

{% block title %}SabriAbiBot - Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Üst Banner -->
    <div class="top-banner glass-effect">
        <div class="container">
            <div class="text-center">
                <h1 class="neon-text-white neon-tap">SabriAbiBot</h1>
            </div>
        </div>
    </div>

    <!-- Ana İçerik -->
    <div class="dashboard-content">
        <div class="container">
            <div class="text-center mb-4">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Sabri Abi" class="main-logo" style="width: 200px; height: 200px;">
            </div>
            <div class="row">
                <!-- Hesap Bilgileri -->
                <div class="col-lg-4">
                    <div class="dashboard-card glass-effect" data-aos="fade-right">
                        <div class="card-header">
                            <i class="fas fa-user-circle"></i>
                            <h3>Hesap Bilgileri</h3>
                        </div>
                        <div class="card-body">
                            <div class="info-item neon-tap">
                                <i class="fas fa-user"></i>
                                <span class="neon-text-white">becool</span>
                            </div>
                            <div class="info-item neon-tap">
                                <i class="fas fa-envelope"></i>
                                <span class="neon-text-white">admin@example.com</span>
                            </div>
                            <div class="info-item neon-tap">
                                <i class="fas fa-id-badge"></i>
                                <span class="neon-text-white">BetGit ID: ADMIN</span>
                            </div>
                            <div class="info-item neon-tap">
                                <i class="fas fa-id-card"></i>
                                <span class="neon-text-white">HasBet ID: ADMIN</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Telegram Bağlantısı -->
                <div class="col-lg-4">
                    <div class="dashboard-card glass-effect" data-aos="fade-up">
                        <div class="card-header">
                            <i class="fab fa-telegram"></i>
                            <h3>Telegram Bağlantısı</h3>
                        </div>
                        <div class="card-body">
                            {% if current_user.telegram_verified %}
                                <div class="status-connected">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Telegram Bağlı: @{{ current_user.telegram_username }}</span>
                                </div>
                                <!-- Özel Kod Girme Alanı -->
                                <div class="special-code-section mt-3">
                                    <h4>Özel Kod</h4>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="specialCode" placeholder="Özel kodu girin">
                                        <button class="btn btn-primary" onclick="submitSpecialCode()">
                                            <i class="fas fa-check"></i> Onayla
                                        </button>
                                    </div>
                                </div>
                            {% else %}
                                <div class="status-disconnected">
                                    <i class="fas fa-times-circle"></i>
                                    <span>Telegram Bağlı Değil</span>
                                </div>
                                <button onclick="startTelegram()" class="btn btn-telegram">
                                    <i class="fab fa-telegram"></i> Telegram'ı Başlat
                                </button>
                                <!-- Telegram Doğrulama Kodu Alanı -->
                                <div class="verification-section mt-3" style="display: none;" id="verificationSection">
                                    <h4>Doğrulama Kodu</h4>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="verificationCode" placeholder="Doğrulama kodunu girin">
                                        <button class="btn btn-primary" onclick="verifyTelegram()">
                                            <i class="fas fa-check"></i> Doğrula
                                        </button>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Son Kullanılan Kodlar -->
                <div class="col-lg-4">
                    <div class="dashboard-card glass-effect" data-aos="fade-left">
                        <div class="card-header">
                            <i class="fas fa-history"></i>
                            <h3>Son Kullanılan Kodlar</h3>
                        </div>
                        <div class="card-body">
                            <div class="codes-list">
                                {% for code in recent_codes %}
                                <div class="code-item">
                                    <span class="code">{{ code.code }}</span>
                                    <span class="date">{{ code.used_at.strftime('%d.%m.%Y %H:%M') }}</span>
                                </div>
                                {% else %}
                                <div class="no-codes">
                                    <i class="fas fa-ticket-alt"></i>
                                    <span>Henüz kod kullanılmamış</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Dashboard Container */
.dashboard-container {
    min-height: 100vh;
    padding: 2rem 0;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Üst Banner */
.top-banner {
    background: rgba(0, 0, 0, 0.7);
    padding: 2rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid rgba(241, 196, 15, 0.3);
}

.banner-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.banner-logo {
    width: 80px;
    height: 80px;
    animation: pulse 2s infinite;
}

.banner-title {
    font-size: 2.5rem;
    margin: 0;
}

/* Dashboard Nav */
.dashboard-nav {
    margin-bottom: 2rem;
    padding: 1rem 0;
    border-top: 1px solid rgba(241, 196, 15, 0.2);
    border-bottom: 1px solid rgba(241, 196, 15, 0.2);
}

.nav-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.nav-buttons {
    display: flex;
    gap: 1rem;
}

.glass-btn {
    background: rgba(241, 196, 15, 0.1);
    border: 1px solid rgba(241, 196, 15, 0.2);
    padding: 0.8rem 1.5rem;
    border-radius: 8px;
    color: #fff;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
}

.glass-btn:hover {
    background: rgba(241, 196, 15, 0.2);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(241, 196, 15, 0.2);
}

.glass-btn.active {
    background: rgba(241, 196, 15, 0.3);
    border-color: rgba(241, 196, 15, 0.5);
}

/* Dashboard Cards */
.dashboard-card {
    height: 100%;
    margin-bottom: 2rem;
    border-radius: 15px;
    overflow: hidden;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.dashboard-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 15px 30px rgba(241, 196, 15, 0.2);
}

.card-header {
    background: rgba(241, 196, 15, 0.1);
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid rgba(241, 196, 15, 0.2);
    position: relative;
    text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
}

.card-header i {
    font-size: 1.5rem;
    color: #f1c40f;
    animation: iconFloat 3s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

.card-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #fff;
}

.card-body {
    padding: 1.5rem;
}

/* Info Items */
.info-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
    padding: 0.8rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    transition: all 0.3s ease;
}

.info-item:hover {
    background: rgba(241, 196, 15, 0.1);
    transform: translateX(5px);
}

.info-item i {
    color: #f1c40f;
    width: 20px;
    text-align: center;
}

/* Telegram Button */
.btn-telegram {
    background: #0088cc;
    color: white;
    border: none;
    transition: all 0.3s ease;
}

.btn-telegram:hover {
    background: #0099dd;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
    color: white;
}

.btn-telegram i {
    margin-right: 8px;
}

/* Codes List */
.codes-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.code-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.code-item:hover {
    background: rgba(241, 196, 15, 0.1);
    transform: translateX(5px);
}

.code {
    font-family: 'Courier New', monospace;
    color: #f1c40f;
}

.date {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
}

.code-item::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(241, 196, 15, 0.1), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

/* Animations */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .nav-buttons {
        flex-direction: column;
    }
    
    .glass-btn {
        width: 100%;
        justify-content: center;
    }

    .dashboard-card:hover {
        transform: translateY(-5px) scale(1.01);
    }
    
    .banner-logo {
        width: 60px;
        height: 60px;
    }
}

/* Kart Parıltı Efekti */
.dashboard-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(241, 196, 15, 0.1) 0%, transparent 50%);
    transform-origin: center;
    animation: cardGlow 6s linear infinite;
}

@keyframes cardGlow {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* İkon Animasyonları */
.card-header i {
    animation: iconFloat 3s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

/* Kod Listesi Animasyonu */
.code-item {
    position: relative;
    overflow: hidden;
}

.code-item::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(241, 196, 15, 0.1), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

/* Telegram Buton Efekti */
.btn-telegram {
    position: relative;
    overflow: hidden;
}

.btn-telegram::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #0088cc, #00a2ff, #0088cc);
    z-index: -1;
    animation: borderRotate 3s linear infinite;
    border-radius: 8px;
}

@keyframes borderRotate {
    0% { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(360deg); }
}

/* Kart Hover Efekti */
.dashboard-card {
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.dashboard-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 15px 30px rgba(241, 196, 15, 0.2);
}

/* Info Item Hover Efekti */
.info-item:hover i {
    transform: scale(1.2) rotate(10deg);
    color: #fff;
    text-shadow: 0 0 10px #f1c40f;
}

/* Neon Text Efekti */
.card-header h3 {
    position: relative;
    text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
}

/* Loading Animasyonu */
.dashboard-container {
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Responsive tasarım güncellemeleri */
@media (max-width: 768px) {
    .dashboard-card:hover {
        transform: translateY(-5px) scale(1.01);
    }
    
    .banner-logo {
        width: 60px;
        height: 60px;
    }
}

/* Neon Buton Stilleri */
.neon-btn {
    position: relative;
    overflow: hidden;
    padding: 10px 20px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.neon-btn.gold {
    border: 1px solid #ffd700;
    color: #ffd700;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.neon-btn.cyan {
    border: 1px solid #00ffff;
    color: #00ffff;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
}

.neon-btn.red {
    border: 1px solid #ff4757;
    color: #ff4757;
    box-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
}

/* Neon Başlık Stilleri */
.neon-title {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.neon-title.gold {
    color: #ffd700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.neon-title.cyan {
    color: #00ffff;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
}

.neon-title.green {
    color: #00ff00;
    text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
}

/* Neon Tap Stilleri */
.neon-tap {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 12px;
    margin: 8px 0;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.neon-tap:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
}

/* Beyaz Neon Text */
.neon-text-white {
    color: #fff;
    text-shadow: 
        0 0 5px #fff,
        0 0 10px rgba(255, 255, 255, 0.5);
}

/* Glow Efekti */
.btn-glow {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
    );
    animation: btnGlow 2s infinite;
}

@keyframes btnGlow {
    0% { left: -100%; }
    50% { left: 100%; }
    100% { left: 100%; }
}

/* SabriAbiBot yazısı için özel neon efekti - biraz daha parlak versiyon */
.top-banner .neon-text-white {
    font-size: 2.5rem;
    font-weight: bold;
    color: #fff;
    text-shadow: 
        0 0 2px #fff,
        0 0 4px #fff,
        0 0 8px #fff,
        0 0 12px rgba(255, 255, 255, 0.8);
    animation: neonPulse 2s infinite alternate;
}

.top-banner .neon-tap {
    display: inline-block;
    padding: 10px 30px;
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(3px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.top-banner .neon-tap:hover {
    background: rgba(255, 255, 255, 0.05);
}

@keyframes neonPulse {
    from {
        text-shadow: 
            0 0 2px #fff,
            0 0 4px #fff,
            0 0 6px rgba(255, 255, 255, 0.8);
    }
    to {
        text-shadow: 
            0 0 2px #fff,
            0 0 6px #fff,
            0 0 10px #fff,
            0 0 14px rgba(255, 255, 255, 0.8);
    }
}

/* Üst Banner için stil güncellemesi */
.top-banner.glass-effect {
    background: rgba(0, 0, 0, 0.2); /* Daha saydam arka plan */
    backdrop-filter: blur(5px); /* Hafif blur efekti */
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding: 1rem;
}

.top-banner .neon-tap {
    background: rgba(255, 255, 255, 0.03); /* Daha saydam arka plan */
    backdrop-filter: blur(3px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.top-banner .neon-tap:hover {
    background: rgba(255, 255, 255, 0.05);
}

/* Üst banner'daki sarı neonlu yazı için minimal neon efekti */
.glow-text {
    color: #ffd700;
    text-shadow: 
        0 0 1px rgba(255, 215, 0, 0.4);
    animation: softGoldGlow 3s infinite alternate;
}

@keyframes softGoldGlow {
    from {
        text-shadow: 
            0 0 1px rgba(255, 215, 0, 0.3);
    }
    to {
        text-shadow: 
            0 0 1px rgba(255, 215, 0, 0.4);
    }
}

/* Telegram kartı stilleri */
.verification-section, .special-code-section {
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    margin-top: 15px;
}

.verification-section h4, .special-code-section h4 {
    color: #fff;
    font-size: 1rem;
    margin-bottom: 10px;
}

.input-group {
    margin-top: 10px;
}

.input-group input {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(241, 196, 15, 0.2);
    color: #fff;
}

.input-group input:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(241, 196, 15, 0.4);
    box-shadow: 0 0 10px rgba(241, 196, 15, 0.2);
    color: #fff;
}

.btn-telegram {
    background: #0088cc;
    color: white;
    border: none;
    transition: all 0.3s ease;
    width: 100%;
    margin-top: 10px;
}

.btn-telegram:hover {
    background: #0099dd;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
    color: white;
}

.btn-telegram i {
    margin-right: 8px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Card hover efektleri
    const cards = document.querySelectorAll('.dashboard-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 10px 20px rgba(241, 196, 15, 0.2)';
        });

        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });
    });

    // Info item animasyonları
    const infoItems = document.querySelectorAll('.info-item');
    infoItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.querySelector('i').classList.add('fa-bounce');
        });

        item.addEventListener('mouseleave', function() {
            this.querySelector('i').classList.remove('fa-bounce');
        });
    });

    // Sayfa yüklenme animasyonu
    AOS.init({
        duration: 1000,
        once: true,
        offset: 100
    });

    // Rastgele parıltı efekti
    function createSparkle() {
        const cards = document.querySelectorAll('.dashboard-card');
        cards.forEach(card => {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = Math.random() * 100 + '%';
            sparkle.style.top = Math.random() * 100 + '%';
            card.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 1000);
        });
    }

    setInterval(createSparkle, 2000);

    // Kart içerik animasyonu
    const cardContents = document.querySelectorAll('.card-body');
    cardContents.forEach(content => {
        content.addEventListener('mousemove', (e) => {
            const rect = content.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            content.style.background = `radial-gradient(circle at ${x}px ${y}px, 
                                      rgba(241, 196, 15, 0.1), 
                                      transparent 50%)`;
        });

        content.addEventListener('mouseleave', () => {
            content.style.background = 'transparent';
        });
    });
});

function startTelegram() {
    fetch('/start_telegram_auth', {
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.open(data.bot_link, '_blank');
            // Doğrulama kod alanını göster
            document.getElementById('verificationSection').style.display = 'block';
        } else {
            alert('Bir hata oluştu. Lütfen daha sonra tekrar deneyin.');
        }
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Bir hata oluştu. Lütfen daha sonra tekrar deneyin.');
    });
}

function verifyTelegram() {
    const code = document.getElementById('verificationCode').value;
    if (!code) {
        alert('Lütfen doğrulama kodunu girin.');
        return;
    }

    fetch('/verify_telegram', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({ code: code })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Telegram hesabınız başarıyla doğrulandı!');
            location.reload();
        } else {
            alert(data.message || 'Doğrulama başarısız. Lütfen tekrar deneyin.');
        }
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Bir hata oluştu. Lütfen daha sonra tekrar deneyin.');
    });
}

function submitSpecialCode() {
    const code = document.getElementById('specialCode').value;
    if (!code) {
        alert('Lütfen özel kodu girin.');
        return;
    }

    fetch('/submit_special_code', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({ code: code })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Tebrikler! Hediye kodunuz: ' + data.gift_code);
            document.getElementById('specialCode').value = '';
        } else {
            alert(data.message || 'Geçersiz kod. Lütfen tekrar deneyin.');
        }
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Bir hata oluştu. Lütfen daha sonra tekrar deneyin.');
    });
}
</script>
{% endblock %} 